# TokenMonitor ä½¿ç”¨æŒ‡å—

> ğŸ‰ **å°ˆæ¡ˆå·²æ•´ç†å®Œæˆï¼** æ‰€æœ‰æª”æ¡ˆå·²é‡æ–°çµ„ç¹”åˆ°åˆé©çš„è³‡æ–™å¤¾ä¸­

## ğŸ“ æ–°çš„å°ˆæ¡ˆçµæ§‹

```
TokenMonitor/
â”œâ”€â”€ ğŸ“‚ scripts/          # ä¸»è¦è…³æœ¬å·¥å…·
â”‚   â”œâ”€â”€ tokusage.ps1     # ä¸»è¦ CLI å·¥å…·
â”‚   â”œâ”€â”€ universal-monitor.ps1
â”‚   â””â”€â”€ legacy/          # èˆŠç‰ˆæª”æ¡ˆ
â”œâ”€â”€ ğŸ“‚ src/              # åŸå§‹ç¢¼
â”‚   â”œâ”€â”€ js/              # JavaScript æ¨¡çµ„
â”‚   â””â”€â”€ go/              # Go èªè¨€æ¨¡çµ„
â”œâ”€â”€ ğŸ“‚ tests/            # æ¸¬è©¦æª”æ¡ˆ
â”‚   â”œâ”€â”€ reports/         # æ¸¬è©¦å ±å‘Š
â”‚   â””â”€â”€ data/            # æ¸¬è©¦è³‡æ–™
â”œâ”€â”€ ğŸ“‚ docs/             # æ–‡ä»¶
â”œâ”€â”€ ğŸ“‚ data/             # ä½¿ç”¨è¨˜éŒ„
â””â”€â”€ ğŸ“‚ build/            # ç·¨è­¯è¼¸å‡º
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ä½¿ç”¨ä¸»è¦ CLI å·¥å…·
```powershell
# æŸ¥çœ‹æ¯æ—¥å ±å‘Š
.\scripts\tokusage.ps1 daily

# æŸ¥çœ‹è©³ç´°çµ±è¨ˆ
.\scripts\tokusage.ps1 summary

# æŸ¥çœ‹å¹«åŠ©
.\scripts\tokusage.ps1 --help
```

## æ¦‚è¿°

é€™å€‹æ”¹é€²çš„ Token ç›£æ§ç³»çµ±èƒ½å¤ å…¨é¢è¿½è¹¤ä½ èˆ‡ Kiro çš„æ‰€æœ‰äº’å‹•ï¼ŒåŒ…æ‹¬ï¼š

1. **èŠå¤©å°è©±** - ä½ çš„è¼¸å…¥å’Œ Kiro çš„å›æ‡‰
2. **å·¥å…·èª¿ç”¨** - Kiro åŸ·è¡Œä»»å‹™æ™‚ä½¿ç”¨çš„å·¥å…·ï¼ˆfsWrite, strReplace ç­‰ï¼‰
3. **ç¨‹å¼ç¢¼ç”Ÿæˆ** - Kiro ç”Ÿæˆçš„ç¨‹å¼ç¢¼å…§å®¹
4. **æ–‡ä»¶å‰µå»º** - Kiro å‰µå»ºçš„ Markdown æ–‡ä»¶å’Œå…¶ä»–æ–‡ä»¶
5. **ä»£ç†ä»»å‹™** - Kiro åŸ·è¡Œçš„å„ç¨®è‡ªå‹•åŒ–ä»»å‹™

## ç³»çµ±çµ„ä»¶

### 1. ä¸»è¦ç›£æ§æ•´åˆè…³æœ¬
- **æª”æ¡ˆ**: `token-monitor-integration.js`
- **åŠŸèƒ½**: è™•ç†æ‰€æœ‰é¡å‹çš„äº‹ä»¶ä¸¦è¨ˆç®— Token æ¶ˆè€—
- **æ”¯æ´äº‹ä»¶**:
  - èŠå¤©è¨Šæ¯ (`chat.message.sent`, `chat.message.received`)
  - å·¥å…·åŸ·è¡Œ (`tool.fsWrite`, `tool.fsAppend`, `tool.strReplace`)
  - ä»£ç†ä»»å‹™ (`agent.codeGeneration`, `agent.documentGeneration`)
  - æª”æ¡ˆæ“ä½œ (`file.saved`, `file.created`, `file.modified`)
  - å°è©±å›åˆ (`kiro.conversation.turn`)

### 2. å…¨é¢ç›£æ§å™¨
- **æª”æ¡ˆ**: `.kiro/hooks/comprehensive-token-monitor.js`
- **åŠŸèƒ½**: è‡ªå‹•ç›£æ§æ‰€æœ‰ Kiro æ´»å‹•
- **ç‰¹é»**:
  - å³æ™‚ç›£æ§å’Œè¨˜éŒ„
  - è‡ªå‹•æˆæœ¬è¨ˆç®—
  - å®šæœŸåˆ†æï¼ˆæ¯5åˆ†é˜ï¼‰
  - çµ±è¨ˆè³‡è¨Šé¡¯ç¤º

### 3. æ‰‹å‹•åˆ†æå™¨
- **æª”æ¡ˆ**: `.kiro/hooks/manual-token-calc.js`
- **åŠŸèƒ½**: æ‰‹å‹•è§¸ç™¼çš„è©³ç´°åˆ†æ
- **æ”¹é€²**:
  - æ”¯æ´æ›´å¤šäº‹ä»¶é¡å‹
  - å¢å¼·çš„çµ±è¨ˆåˆ†é¡
  - è©³ç´°çš„æˆæœ¬åˆ†æ

## ä½¿ç”¨æ–¹æ³•

### è‡ªå‹•ç›£æ§
ç³»çµ±æœƒè‡ªå‹•ç›£æ§æ‰€æœ‰æ´»å‹•ï¼Œç„¡éœ€æ‰‹å‹•æ“ä½œã€‚ç›£æ§è³‡æ–™æœƒè¨˜éŒ„åˆ° `data/kiro-usage.log`ã€‚

### æ‰‹å‹•åˆ†æ
1. åœ¨ Kiro çš„ Agent Hooks é¢æ¿ä¸­æ‰¾åˆ° "Kiro Chat Token Calculator"
2. é»æ“ŠåŸ·è¡ŒæŒ‰éˆ•
3. æŸ¥çœ‹è©³ç´°çš„åˆ†æå ±å‘Š

### æŸ¥çœ‹å³æ™‚çµ±è¨ˆ
ç›£æ§ç³»çµ±æœƒåœ¨æ§åˆ¶å°é¡¯ç¤ºå³æ™‚çµ±è¨ˆï¼š
```
ğŸ“Š [14:30:25] ai_code_generation: 45 tokens (0.000675 USD)
   ğŸ”§ å·¥å…·: tool.fsWrite - write
   ğŸ“ æª”æ¡ˆ: fibonacci.js
   ğŸ’° æˆæœ¬: 0.000675 USD
```

## ç›£æ§çš„æ´»å‹•é¡å‹

### èŠå¤©ç›¸é—œ
- `chat` - ä¸€èˆ¬èŠå¤©å°è©±
- `coding` - ç¨‹å¼è¨­è¨ˆç›¸é—œè¨è«–
- `debugging` - é™¤éŒ¯å’Œå•é¡Œè§£æ±º
- `documentation` - æ–‡ä»¶æ’°å¯«

### AI ç”Ÿæˆå…§å®¹
- `ai_code_generation` - AI ç”Ÿæˆç¨‹å¼ç¢¼
- `ai_documentation` - AI ç”Ÿæˆæ–‡ä»¶
- `ai_debugging` - AI å”åŠ©é™¤éŒ¯
- `ai_refactoring` - AI å”åŠ©é‡æ§‹
- `ai_testing` - AI å”åŠ©æ¸¬è©¦

### å·¥å…·æ“ä½œ
- `tool_execution` - å·¥å…·åŸ·è¡Œ
- `file_operations` - æª”æ¡ˆæ“ä½œ
- `configuration` - é…ç½®æª”æ¡ˆä¿®æ”¹

## æˆæœ¬è¨ˆç®—

ç³»çµ±ä½¿ç”¨ Claude Sonnet 4.0 çš„å®šåƒ¹ï¼š
- **è¼¸å…¥ Token**: $3.00 / 1M tokens
- **è¼¸å‡º Token**: $15.00 / 1M tokens

## åˆ†æå ±å‘Šå…§å®¹

### åŸºæœ¬çµ±è¨ˆ
- ç¸½è¨˜éŒ„æ•¸
- è¼¸å…¥/è¼¸å‡º Token æ•¸é‡
- ç¸½æˆæœ¬ï¼ˆUSDï¼‰

### æ´»å‹•é¡å‹çµ±è¨ˆ
- å„é¡å‹æ´»å‹•çš„æ¬¡æ•¸å’Œ Token æ¶ˆè€—
- æˆæœ¬åˆ†æ

### æœƒè©±çµ±è¨ˆ
- å„æœƒè©±çš„ Token ä½¿ç”¨æƒ…æ³
- æœ€æ´»èºçš„æœƒè©±

### æ¨¡å‹ä½¿ç”¨çµ±è¨ˆ
- ä¸åŒæ¨¡å‹çš„ä½¿ç”¨æƒ…æ³
- å„æ¨¡å‹çš„æˆæœ¬åˆ†æ

### äº‹ä»¶é¡å‹çµ±è¨ˆ
- å„ç¨®äº‹ä»¶çš„ç™¼ç”Ÿé »ç‡
- Token æ¶ˆè€—åˆ†å¸ƒ

## æ¸¬è©¦ç³»çµ±

é‹è¡Œæ¸¬è©¦è…³æœ¬ä¾†é©—è­‰ç›£æ§ç³»çµ±ï¼š
```bash
node test-token-monitoring.js
```

æ¸¬è©¦åŒ…æ‹¬ï¼š
- èŠå¤©å°è©±ç›£æ§
- å·¥å…·èª¿ç”¨ç›£æ§
- ä»£ç†ä»»å‹™ç›£æ§
- æª”æ¡ˆæ“ä½œç›£æ§
- å°è©±å›åˆç›£æ§
- æ‰‹å‹•åˆ†æå™¨

## é…ç½®é¸é …

### å…¨é¢ç›£æ§å™¨è¨­å®š (`.kiro/hooks/comprehensive-token-monitor.json`)
```json
{
  "settings": {
    "logFile": "data/kiro-usage.log",
    "realtimeDisplay": true,
    "costTracking": true,
    "sessionTracking": true,
    "detailedLogging": true,
    "autoAnalysis": true,
    "analysisInterval": 300000
  }
}
```

### æ‰‹å‹•åˆ†æå™¨è¨­å®š (`.kiro/hooks/manual-token-calc.json`)
```json
{
  "settings": {
    "logFile": "data/kiro-usage.log",
    "outputFormat": "detailed",
    "includeCostAnalysis": true,
    "showActivityBreakdown": true
  }
}
```

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **ç›£æ§æ²’æœ‰è¨˜éŒ„è³‡æ–™**
   - æª¢æŸ¥ `data` è³‡æ–™å¤¾æ˜¯å¦å­˜åœ¨
   - ç¢ºèª Hook æ˜¯å¦å·²å•Ÿç”¨
   - æŸ¥çœ‹æ§åˆ¶å°éŒ¯èª¤è¨Šæ¯

2. **Token è¨ˆç®—ä¸æº–ç¢º**
   - ç¢ºèª `token-monitor.exe` æ˜¯å¦å­˜åœ¨
   - æª¢æŸ¥ç¶²è·¯é€£ç·šï¼ˆå¦‚æœä½¿ç”¨ç·šä¸Š APIï¼‰
   - æŸ¥çœ‹ä¼°ç®—å‡½æ•¸æ˜¯å¦æ­£å¸¸é‹ä½œ

3. **åˆ†æå ±å‘Šç‚ºç©º**
   - ç¢ºèª `kiro-usage.log` æª”æ¡ˆå­˜åœ¨ä¸”æœ‰å…§å®¹
   - æª¢æŸ¥æª”æ¡ˆæ¬Šé™
   - ç¢ºèªæ—¥èªŒæ ¼å¼æ­£ç¢º

### æ—¥èªŒæª”æ¡ˆæ ¼å¼
æ¯ç­†è¨˜éŒ„éƒ½æ˜¯ä¸€å€‹ JSON ç‰©ä»¶ï¼š
```json
{
  "timestamp": "2025-07-31T05:57:38.098Z",
  "event": "chat_message",
  "direction": "sent",
  "content_length": 35,
  "tokens": 32,
  "activity_type": "general",
  "model": "claude-sonnet-4.0",
  "session_id": "session-1753941459410-d8s3ud",
  "cost_analysis": {
    "tokens": 32,
    "cost_usd": 0.000096,
    "cost_type": "input",
    "model": "claude-sonnet-4.0",
    "pricing_rate": 3
  }
}
```

## é€²éšåŠŸèƒ½

### è‡ªè¨‚æ´»å‹•åˆ†é¡
ä½ å¯ä»¥ä¿®æ”¹ `classifyActivity` å’Œ `classifyAgentActivity` å‡½æ•¸ä¾†è‡ªè¨‚æ´»å‹•åˆ†é¡é‚è¼¯ã€‚

### æˆæœ¬è­¦å‘Š
ç•¶ç¸½æˆæœ¬è¶…éè¨­å®šé–¾å€¼æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•ç™¼å‡ºè­¦å‘Šã€‚

### å®šæœŸå ±å‘Š
ç³»çµ±æ¯5åˆ†é˜æœƒè‡ªå‹•é‹è¡Œä¸€æ¬¡åˆ†æï¼Œæä¾›ä½¿ç”¨æƒ…æ³æ‘˜è¦ã€‚

## ç¸½çµ

é€™å€‹æ”¹é€²çš„ç›£æ§ç³»çµ±ç¾åœ¨èƒ½å¤ ï¼š

âœ… **å®Œæ•´ç›£æ§ä½ çš„è¼¸å…¥å’Œ Kiro çš„è¼¸å‡º**
âœ… **è¿½è¹¤æ‰€æœ‰å·¥å…·èª¿ç”¨å’Œç¨‹å¼ç¢¼ç”Ÿæˆ**
âœ… **æä¾›è©³ç´°çš„æˆæœ¬åˆ†æ**
âœ… **æ”¯æ´å¤šç¨®äº‹ä»¶é¡å‹**
âœ… **å³æ™‚é¡¯ç¤ºçµ±è¨ˆè³‡è¨Š**
âœ… **è‡ªå‹•åŒ–åˆ†æå’Œå ±å‘Š**

ä½ ç¾åœ¨å¯ä»¥å…¨é¢äº†è§£èˆ‡ Kiro äº’å‹•çš„ Token æ¶ˆè€—æƒ…æ³ï¼ŒåŒ…æ‹¬èŠå¤©å°è©±å’Œæ‰€æœ‰ä»»å‹™åŸ·è¡Œéç¨‹ä¸­ç”¢ç”Ÿçš„å…§å®¹ã€‚